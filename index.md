# WEBサーバ構築方法の学習

この資料ではWEBサーバ構築のための方法を記載する

# 使用するサーバ
使用するサーバは以下になります。
ポピュラーなOSで実際の現場でも多く使用されているCentOS7を使用します

```
さくら VPS 1Gプラン
HDD 100G
カスタムOS CentOS7 x86_64
```

# 使用するモジュール
今回は以下のモジュールを使用して開発を行います

| モジュール名 | 用途 |
|:----|:----|
|Apache2.4|コンテンツ(htmlなど)をサーバからブラウザに返す|
|Ruby(rails)|コンテンツを作成する|
|postfix|メールを送信する|
|mysql|DBを使用するため|

# 学習工程

この資料を通して以下の事が出来るようになる事が第一目的です。
全てWEBサーバを構築するために最低限必要な項目になります。

|項目|詳細|
|:--|:--|
|sshログイン|構築をするためにはまずサーバに入レなければなりません|
|ユーザの作成|root権限(神)を持つユーザを作成して、全てのセットアップができるようにします|
|viコマンドの理解|サーバのファイルをviコマンドを使って編集しますので最低限の知識|
|セキュリティの設定| デフォルトの設定のままだとサーバが乗っ取られてしまいますので対策をします|
|Apacheの設定|Apacheと呼ばれるWEBサーバ本体のセットアップをします|
|Mysqlの設定|Mysqlと呼ばれるDBツールを使用し、DBを使えるようにします。また外部からDBへ接続できるようにするための設定なども行います|
|railsの設定|defaultのrailsテンプレートを動かせるようにします|
|postfixの設定|メールの送信のためにpostfixと呼ばれるモジュールの設定を行います|

## コラム1　ポートとは

サーバにはポート(port)というものがあります。

簡単に説明するとポートとはサーバについている穴です。
サーバにはポート（穴）がたくさん存在します。

サーバはどの穴を通ってきたリクエストなのかを判定して特定の処理を送ります。

例えばブラウザでサイトにアクセスするときに
ブラウザ側(クライアント側)では80portや336portという決まったポートに対してアクセスします。
これによってサーバ側では80portにアクセスが来たからhtmlを返せば良いのだと判断します。
ブラウザが間違って90portなどでアクセスしてしまうとサーバ側では何のアクセスなのかが分からずに、リクエストを処理できません。

代表的なポートを以下に記載しておきます。
そこまで詳しく覚えておく必要はありません。
|port|用途|
|:--|:--|
|22 | ssh接続に使用されることが多い。バレると危ないので変更するケースが多い|
|80| http接続に使う|
|443|https接続に使う|
|3306|mysqlへの接続に使う|


## sshログイン
linuxのssh コマンドを使用してサーバへログインします。
windowsの方はコマンドがないので
bash on ubuntなどを使用してください。

代表的な使い方は以下の通りです
```
    ssh -p ポート番号 ユーザ名@IPアドレス
```
-pがオプションでその後にポート番号を指定します。


例えば サーバの情報が
```
port      デフォルトの22
IPアドレス 192.168.0.1
ユーザ     root(神)
password  pass
```
だった時は

ssh -p 22 root@192.168.0.1
を打った後にパスワードが聞かれるので入力するとサーバにログインできます。


sshコマンドは超重要なコマンドです。
このコマンドが使えないとサーバに入ることもできません。

ドラマなどに出ているハッカーなどはsshコマンドでサーバに入って情報などを盗んでいますが、入るまでが難しいのです。

## ユーザを作成する
おそらく前の項目を理解している人はrootユーザでログインできたのになぜ他のユーザを作成する必要があるのかと思うかもしれません。

それはrootは神の力を持つので、直接使うのは危険だからです。本来rootでログインすること自体がNGです。

そこで以下の二種類のユーザを作成します。
* root(神)の力を借りられないユーザ
* root(神)の力を借りられるユーザ


### root(神)の力を借りられないユーザの作成方法
例えば yryuuユーザを作成するためには以下の2つのコマンドを打つだけです。

**ユーザ作成方法**

①ユーザを追加する
useradd yryuu

②ユーザのパスワードを設定する
passwd yryuu

これらのコマンドを実行したら
/homeディレクトリに作成したユーザのディレクトリが作成されます。

**確認方法**
ディレクトリに移動するためのコマンドcd(change directory)とディレクトリのリストをみるコマンドls(list)で確認してみましょう

```
cd /home
ls

```
これで作成したユーザのディレクトリが表示されればOKです

ssh コマンドでのログインもできるようになっているはずなので確認してみましょう
exitコマンドを打つとサーバからログアウトできます。
のでログアウト後にサイド作成したユーザでsshログインしてみてください。

```
ssh -p 22 yryuu@IPアドレス
```

### root(神)の力を借りられるユーザの作成方法
root(神)の力を借りるためには作成したユーザがwheelというグループに入らなければなりません。
実はもう一つ設定が必要なのですが、ここでは説明しません

またyryuuユーザを例に説明します
**ユーザ作成方法**

①ユーザを追加する
useradd yryuu

②ユーザのパスワードを設定する
passwd yryuu

③ユーザをwheelグループに追加する
usermod -g wheel yryuu

これらのコマンドを実行したらrootの力を借りられるユーザの作成完了です。

# 確認方法
exitコマンドでログアウトし
作成したユーザで再度sshログインしてみてください

```
ssh -p 22 yryuu@IPアドレス
```

ログインに成功したらいよいよrootの力を借りてみましょう

rootの力はsudoコマンドを使います
sudoの使い方は以下の通りです

```
sudo 好きなコマンド
```

試しに以下のコマンドを打ってみてください
touchコマンドはファイルを作成するコマンドです
lsは今いるディレクトリの中のファイル一覧を見るコマンドです
```
sudo touch test.html
ls
```

test.htmlが表示されればrootの力を借りてファイルを作成できたことになります

